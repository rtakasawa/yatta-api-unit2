<div class="container">
  <div class="card card-body bg-light">
    <%= t("view.material.index") %>

  </div>

  <!--絞り込み検索-->
  <div class="mt-4" >
    <%= search_form_for @q, html: { class: 'navbar-form navbar-left' } do |f| %>
      <div class="row">
        <div class="col-sm-6">
          <div class="form-group">
            <%= f.label :title, t("view.material.refine_keywords") %>
            <%= f.search_field :title_or_tags_name_cont, class: "form-control" %>
            <small class="help-block"><%= t("view.material.search_material_name_tag_name") %></small><br>
          <small class="help-block"><%= t("view.material.cannot_search_with_multiple_keywords") %></small>
        </div>
      </div>
      <div class="col-sm-3">
        <div class="form-group">
          <%= f.label :category_eq, t("view.material.refine_categories") %>
          <%= f.select :category_eq, Material.categories.map { |k, v| [Material.categories_i18n[k], v]},{include_blank: '選択ボックス'}, class: "form-control" %>
        </div>
      </div>
        <div class="col-sm-3">
          <div class="form-group">
            <%= f.label :status_eq, t("view.material.refine_status") %>
            <%= f.select :status_eq, Material.statuses.map { |k, v| [Material.statuses_i18n[k], v]},{include_blank: '選択ボックス'}, class: "form-control"  %>
          </div>
        </div>
        <div class="form-check-inline m-3">
          <%= f.submit t("view.material.refine"), class: 'btn btn-primary' %>
        </div>
        <div class="form-check-inline">
          <%= link_to t("view.material.clear"), url_for, class: "btn btn-primary", role: "button" %>
        </div>
    <% end %>
    </div>
  </div>

  <!--検索結果-->
  <div class="mt-4" >
    <%= paginate @materials, class: "paginate"  %>
    <%= page_entries_info @materials %>
  </div>

  <div class="mt-4" >
    <div class="table-responsive" >
      <table class="table text-nowrap">
      <thead class="thead-light">
      <tr>
        <th><%= t("activerecord.attributes.material.title") %></th>
        <th><%= t("activerecord.attributes.material.category") %></th>
        <th><%= t("activerecord.attributes.material.status") %></th>
        <th><%= t("view.tag.tags") %></th>
        <!--    ここもスコープかと思う-->
        <!--    <th><%#= sort_link(@q,:works_created_at,'最新の学習登録日') %></th>-->
        <th><%= t("view.work.latest_day") %></th>
        <th colspan="3"><%= t("view.work.latest_amount") %></th>
      </tr>
      </thead>
        <tbody>
        <% @materials.each do |material| %>
          <tr>
            <td><%= link_to material.title, material_path(material) %></td>
            <td><span class="badge badge-pill badge-info"><%= material.category_i18n %></span></td>
            <% if material.status == "learning" %>
              <td><span class="badge badge-pill badge-info"><%= material.status_i18n %></span></td>
            <% else %>
              <td><span class="badge badge-pill badge-secondary"><%= material.status_i18n %></span></td>
            <% end %>
            <td><%= render 'materials/tag_list', tag_list: material.tag_list %></td>
            <% if material.works.present? %>
              <% last_created_work = material.works.order(created_at: :desc).limit(1) %>
              <% last_created_work.each do |last_work| %>
                <td><%= last_work.do_on %></td>
                <td><%= last_work.start %></td>
                <td>〜</td>
                <td><%= last_work.finish %></td>
              <% end %>
            <% else %>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            <% end %>
          </tr>
        <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>